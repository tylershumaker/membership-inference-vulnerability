<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<style type="text/css">

    body {
        font-family:  "Palatino Linotype", "Book Antiqua", Palatino, serif;
        background-color: white;
        padding: 30px;
    }

    h1 {
        font-size: 24px;
        margin: 0;
    }

    p {
        font-size: 14px;
        margin: 10px 0 0 0;
    }

    svg {
        background-color: white;
    }


    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }

</style>
<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>

    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 30, left: 60},
        width = 1200 - margin.left - margin.right,
        height = 700 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right + 60)
        .attr("height", height + margin.top + margin.bottom + 20)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    //Read the data
    d3.json("results_membership_vulnerability_confidences_1.json", function (json) {
        data = json.vulnerability_results;

        var xMin = d3.min(data, function (d) {
            return Number(d.example_class);
        });
        var xMax = d3.max(data, function (d) {
            return Number(d.example_class);
        });
        var yMin = d3.min(data, function (d) {
            return Number(Math.abs(d.vulnerability_difference));
        });
        var yMax = d3.max(data, function (d) {
            return Number(Math.abs(d.vulnerability_difference));
        });

        var xScale = d3.scaleLinear().domain([xMin, xMax]).range([margin.right, width - margin.right * 2]);
        var yScale = d3.scaleLinear().domain([yMin, yMax]).range([height - margin.bottom, margin.top * 2]);

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale));
        svg.append("text")
            .attr("class", "label")
            .attr("x", width - 360)
            .attr("y", height + margin.top + margin.bottom)
            .style("text-anchor", "end")
            .text("Classes");

        svg.append("g")
            .call(d3.axisLeft(yScale));
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y",-margin.top*3.3) //bigger mulitplier moves to the left
            .attr("x",-height/2)  //smaller divider moves up
            .attr("dy", ".71em")
            .style("text-anchor", "middle")
            .text("Vulnerability Difference (Absolute)")
            .attr("font-family","serif")
            .attr("font-size","16px");

        svg.append("circle").attr("cx",1070).attr("cy",60).attr("r", 6).style("fill", "red")
        svg.append("circle").attr("cx",1070).attr("cy",90).attr("r", 6).style("fill", "blue")
        svg.append("text").attr("x", 1090).attr("y", 60).text("predicted IN").style("font-size", "15px").attr("alignment-baseline","middle")
        svg.append("text").attr("x", 1090).attr("y", 90).text("predicted OUT").style("font-size", "15px").attr("alignment-baseline","middle")

        svg.append('g')
            .selectAll("dot")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function (d) {
                return xScale(d.example_class);
            })
            .attr("cy", function (d) {
                return yScale(Math.abs(d.vulnerability_difference));
            })
            .attr("r", 2)
            .attr("fill", function (d) {
                // var abs = Math.abs(d.vulnerability_difference);
                var target_pred = d.predictions.target_prediction;
                var i = target_pred > 0 ? 1 : 0;

                return ['blue', 'red'][i];
            })
            .on('mouseover', function (d, i) {
                d3.select(this).transition()
                    .duration('100')
                    .attr("r", 4);
                div.transition()
                    .duration(100)
                    .style("opacity", 1);
                div.html("Index: " + (d.example_index)
                    + "<br/>"+ "Class: " + (d.example_class)
                    + "<br/>"+ "  Target Conf: " + (d.confidences.target_confidence)
                    + "<br/>"+ "  Shadow Conf: " + (d.confidences.shadow_confidence)
                    + "<br/>"+ "  Vulnerability (Absolute): " + (Math.abs(d.vulnerability_difference))
                    + "<br/>"+ "  Predictions:  Target: " + (d.predictions.target_prediction)
                    + " Shadow: " + (d.predictions.shadow_prediction)
                    + "<br/>"+ "<img src='images/"+d.example_class+"-"+d.example_index+".png' alt='Smiley face' height='42' width='42'>")
                    .style("left", (d3.event.pageX + 10) + "px")
                    .style("top", (d3.event.pageY - 15) + "px");
            })
            .on('mouseout', function (d, i) {
                d3.select(this).transition()
                    .duration('200')
                    .attr("r", 2);
                // div.transition()
                //     .duration('200')
                //     .style("opacity", 0);
            });

    })

</script>