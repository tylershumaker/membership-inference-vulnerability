<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<style type="text/css">

    body {
        font-family:  "Palatino Linotype", "Book Antiqua", Palatino, serif;
        background-color: white;
        padding: 50px;
    }

    h1 {
        font-size: 24px;
        margin: 0;
    }

    p {
        font-size: 14px;
        margin: 10px 0 0 0;
    }

    svg {
        background-color: white;
    }


    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }

</style>
<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>

    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 30, left: 60},
        width = 800 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom + 20)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    //Read the data
    d3.json("results_membership_vulnerability_confidences_1.json", function (json) {
        data = json.vulnerability_results;

        var xMin = d3.min(data, function (d) {
            return Number(d.example_class);
        });
        var xMax = d3.max(data, function (d) {
            return Number(d.example_class);
        });
        var yMin = d3.min(data, function (d) {
            return Number(Math.abs(d.vulnerability_difference));
        });
        var yMax = d3.max(data, function (d) {
            return Number(Math.abs(d.vulnerability_difference));
        });

        var xScale = d3.scaleLinear().domain([xMin, xMax]).range([margin.right, width - margin.right * 2]);
        var yScale = d3.scaleLinear().domain([yMin, yMax]).range([height - margin.bottom, margin.top * 2]);

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale));
        svg.append("text")
            .attr("class", "label")
            .attr("x", width - 360)
            .attr("y", height + margin.top + margin.bottom)
            .style("text-anchor", "end")
            .text("Classes");

        svg.append("g")
            .call(d3.axisLeft(yScale));
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y",-margin.top*3.3) //bigger mulitplier moves to the left
            .attr("x",-height/2)  //smaller divider moves up
            .attr("dy", ".71em")
            .style("text-anchor", "middle")
            .text("Vulnerability Difference (Absolute)")
            .attr("font-family","serif")
            .attr("font-size","16px");

        svg.append('g')
            .selectAll("dot")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function (d) {
                return xScale(d.example_class);
            })
            .attr("cy", function (d) {
                return yScale(Math.abs(d.vulnerability_difference));
            })
            .attr("r", 2)
            .attr("fill", function (d) {
                // var abs = Math.abs(d.vulnerability_difference);
                var target_pred = d.predictions.target_prediction;
                var i = target_pred > 0 ? 1 : 0;

                return ['blue', 'red'][i];
            })
            .on('mouseover', function (d, i) {
                d3.select(this).transition()
                    .duration('100')
                    .attr("r", 7);
                div.transition()
                    .duration(100)
                    .style("opacity", 1);
                div.html("Index: " + (d.example_index)
                    + "<br/>"+ "Class: " + (d.example_class)
                    + "<br/>"+ "  Target Conf: " + (d.confidences.target_confidence)
                    + "<br/>"+ "  Shadow Conf: " + (d.confidences.shadow_confidence)
                    + "<br/>"+ "  Vulnerability (Absolute): " + (Math.abs(d.vulnerability_difference))
                    + "<br/>"+ "  Predictions:  Target: " + (d.predictions.target_prediction)
                    + " Shadow: " + (d.predictions.shadow_prediction))
                    .style("left", (d3.event.pageX + 10) + "px")
                    .style("top", (d3.event.pageY - 15) + "px");
            })
            .on('mouseout', function (d, i) {
                d3.select(this).transition()
                    .duration('200')
                    .attr("r", 2);
                div.transition()
                    .duration('200')
                    .style("opacity", 0);
            });

        svg.append("image")
            .attr("xlink:href", "temp.png")
            .attr("width", "40")
            .attr("height", "40")
            .attr("x", width - 560)
            .attr("y", height + 15);

        // var legendRectSize = 17;
        // var legendSpacing = 4;
        //
        // var legend = svg.selectAll('.legend-bar')
        //     .data(data)
        //     .enter()
        //     .append('g')
        //     .attr('class', 'legend-bar')
        //     .attr('transform', function (d, i) {
        //         var height = legendRectSize + legendSpacing;
        //         // var offset = height * color.domain().length / 2;
        //         var horz = width - 40;
        //         var vert = i * height + 7;
        //         return 'translate(' + horz + ',' + vert + ')';
        //     });
        //
        // legend.append('rect')
        //     .attr('width', legendRectSize)
        //     .attr('height', legendRectSize)
        //     .style('fill', color)
        //     .style('stroke', color);
        //
        // legend.append('text')
        //     .attr('x', legendRectSize + legendSpacing)
        //     .attr('y', legendRectSize - legendSpacing)
        //     .text(function (d) {
        //         return key[d]
        //     });

    })

</script>