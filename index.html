<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<style type="text/css">

    body {
        font-family:  "Palatino Linotype", "Book Antiqua", Palatino, serif;
        background-color: white;
        padding: 5px;
    }

    h1 {
        font-size: 24px;
        margin: 0;
    }

    p {
        font-size: 10px;
        margin: 10px 0 0 0;
    }

    svg {
        background-color: white;
    }


    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }
    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

    /* Style the buttons inside the tab */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 6px 10px;
        transition: 0.3s;
        font-size: 12px;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
        background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
    }
    h4 {
        margin-block-start: 0.1em;
        margin-block-end: 0.1em;
    }

    .label {
        font-size: 12px;
    }

    .left-div {
        float: left;
        width: 400px;
        height: 20px;
        margin-right: 8px;
    }
    .right-div {
        margin-left: 408px;
    }

</style>

<div class="tab">
    <button class="tablinks active" onclick="openTab(event, 'experiment1')">Experiment Results</button>
    <button class="tablinks" onclick="openTab(event, 'experiment14')">EMNIST19  Exp 1 & 2 Compare</button>
    <button class="tablinks" onclick="openTab(event, 'experiment15')">EMNIST19  Exp 1 & 2 Abs</button>
    <button class="tablinks" onclick="openTab(event, 'experiment16')">EMNIST20  Exp 1 & 2 Compare</button>
    <button class="tablinks" onclick="openTab(event, 'experiment18')">CIFAR10 4stack  Exp 1 & 2 Compare</button>
</div>
<div id="experiment1" class="tabcontent" style="display: block;">
    <label>Vulnerability Value</label>
    <input type="range" name="mySlider" id=mySlider min="-10.0" max="10.0" step="0.5" value="1.0">
    <input type="text" id="textInput" value="1.0">
    <label>Experiment</label>
    <select id="selectResult"></select>
    <div id="my_dataviz"></div>
</div>
<div id="experiment14" class="tabcontent" style="display: none;">
    <div id="my_dataviz14"></div>
</div>
<div id="experiment15" class="tabcontent" style="display: none;">
    <div id="my_dataviz15"></div>
</div>
<div id="experiment16" class="tabcontent" style="display: none;">
    <div id="my_dataviz16"></div>
</div>
<div id="experiment18" class="tabcontent" style="display: none;">
    <div id="my_dataviz18"></div>
</div>
<script>

    var selectedValue = 1.0;
    var selectedOption = "0";
    var log_file = "results_emnist9_All.json";
    var class_log_file = "results_emnist9_All.json";
    var class_log_file2 = "results_emnist8C_All.json";
    var selectedResult = "baseline";
    var imageDir = 'emnist';
    var classesList = [];

    // var selectedClassData;
    function openTab(evt, experimentName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        if (experimentName === "experiment14"){
            displayCompare("#my_dataviz14", "results_emnist19a_all.json","results_emnist19b_all.json", "1", "2");
        }
        else if (experimentName === "experiment15"){
            displayAbs("#my_dataviz15", "results_emnist19a_all.json","results_emnist19b_all.json", "1", "2");
        }
        else if (experimentName === "experiment16"){
            displayCompare("#my_dataviz16", "results_emnist20a_all.json","results_emnist20b_all.json", "1", "2");
        }
        else if (experimentName === "experiment18"){
            displayCompare("#my_dataviz18", "results_cifar10_dan4stacks_a_all.json","results_cifar10_dan4stacks_b_all.json", "1", "2");
        }
        else{
            displayGraph("#my_dataviz", log_file, imageDir, selectedValue);
        }
        document.getElementById(experimentName).style.display = "block";
        evt.currentTarget.className += " active";
    }

    var div = d3.select("body").append("div")
        .attr("id", "tooltip")
        .attr("class", "left-div")
        .style("opacity", 0);

    var div2 = d3.select("body").append("div")
        .attr("id", "tooltip2")
        .attr("class", "right-div")
        .style("opacity", 0);

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 30, left: 60},
    width = 1200 - margin.left - margin.right,
    height = 650 - margin.top - margin.bottom;

    d3.select("#mySlider").on("change", function(d){
        selectedValue = this.value;
        document.getElementById('textInput').value=selectedValue;
        displayGraph("#my_dataviz", log_file, imageDir, selectedValue);
    });

    //create array of number of classes (47 for emnist)
    for (var i = 0; i <= 46; i++) {
        classesList.push(i);
    }

    d3.select("#selectButton")
        .selectAll('myOptions')
        .data(classesList)
        .enter()
        .append('option')
        .text(function (d) { return d; }) // text showed in the menu
        .attr("value", function (d) { return d; }); // corresponding value returned

    // When the button is changed, run the updateChart function
    d3.select("#selectButton").on("change", function(d) {
        selectedOption = d3.select(this).property("value");
        console.log(selectedOption);
        displayClassImages("#my_dataviz2", class_log_file, class_log_file2, "emnist", selectedValue, selectedOption);
    });

    var experimentList = ['emnist19a', 'emnist19b',
                          'emnist20a', 'emnist20b',
                          'emnist20_O_out', 'emnist20_O_rest', 'emnist20_O_all',
                          'cifar10_4stacks_a', "cifar10_4stacks_b"];

    d3.select("#selectResult")
        .selectAll('myOptions')
        .data(experimentList)
        .enter()
        .append('option')
        .text(function (d) { return d; }) // text showed in the menu
        .attr("value", function (d) { return d; }); // corresponding value returned

    d3.select("#selectResult").on("change", function(d) {
        selectedResult = d3.select(this).property("value")
        console.log(selectedResult);
        switch(selectedResult){
            case "emnist19a":
                log_file="results_emnist19a_all.json";
                imageDir = "N/A";
                break;
            case "emnist19b":
                log_file="results_emnist19b_all.json";
                imageDir = "N/A";
                break;
            case "emnist20a":
                log_file="results_emnist20a_all.json";
                imageDir = "N/A";
                break;
            case "emnist20b":
                log_file="results_emnist20b_all.json";
                imageDir = "N/A";
                break;
            case "emnist20_O_out":
                log_file="results_emnist20_out_out.json";
                imageDir = "N/A";
                break;
            case "emnist20_O_rest":
                log_file="results_emnist20_out_rest.json";
                imageDir = "N/A";
                break;
            case "emnist20_O_all":
                log_file="results_emnist20_out_all.json";
                imageDir = "N/A";
                break;
            case "cifar10_4stacks_a":
                log_file="results_cifar10_dan4stacks_a_all.json";
                imageDir = "N/A";
                break;
            case "cifar10_4stacks_b":
                log_file="results_cifar10_dan4stacks_b_all.json";
                imageDir = "N/A";
                break;
            default:
                log_file = "results_emnist9_All.json";
                imageDir = "N/A";
        }

        displayGraph("#my_dataviz", log_file, imageDir, selectedValue);

    });

    function displayGraph(divName, jsonFile, imageDir, vulnValue){
        d3.select(divName).html("");
        d3.select("#target").html("");
        d3.select("#tooltip").html("");
        d3.select("#tooltip2").html("");
        var svg = d3.select(divName)
            .append("svg")
            .attr("width", width + margin.left + margin.right + 60)
            .attr("height", height + margin.top + margin.bottom + 20)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
        d3.json(jsonFile, function (json) {
            // svg.append("text")
            //     .attr("x", 500)
            //     .attr("y", 10)
            //     .style("text-anchor", "end")
            //     .text(json.target_model);
            svg.append("text")
                .attr("x", 600)
                .attr("y", 10)
                .style("text-anchor", "end")
                .text(json.target_accuracy);

            data = json.vulnerability_results;

            var xMin = d3.min(data, function (d) {
                return Number(d.example_class);
            });
            var xMax = d3.max(data, function (d) {
                return Number(d.example_class);
            });
            var yMin = d3.min(data, function (d) {
                // return Number(Math.abs(d.vulnerability_difference));
                return Number(d.vulnerability_difference);
            });
            var yMax = d3.max(data, function (d) {
                // return Number(Math.abs(d.vulnerability_difference));
                return Number(d.vulnerability_difference);
            });

            var xScale = d3.scaleLinear().domain([xMin, xMax]).range([margin.right, width - margin.right * 2]);
            var yScale = d3.scaleLinear().domain([yMin, yMax]).range([height - margin.bottom, margin.top * 2]);

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(xScale));
            svg.append("text")
                .attr("class", "label")
                .attr("x", width - 360)
                .attr("y", height + margin.top + margin.bottom)
                .style("text-anchor", "end")
                .text("Classes");

            svg.append("g")
                .call(d3.axisLeft(yScale));
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y",-margin.top*3.3) //bigger mulitplier moves to the left
                .attr("x",-height/2)  //smaller divider moves up
                .attr("dy", ".71em")
                .style("text-anchor", "middle")
                .text("Vulnerability Difference (Absolute)")
                .attr("font-family","serif")
                .attr("font-size","16px");

            svg.append("circle")
                .attr("cx",1070)
                .attr("cy",60)
                .attr("r", 6)
                .style("fill", "red")
                .on("click", function(){
                    // is the element currently visible ?
                    currentOpacity = d3.selectAll(".red").style("opacity")
                    // Change the opacity: from 0 to 1 or from 1 to 0
                    d3.selectAll(".red").transition().style("opacity", currentOpacity == 1 ? 0:1)});
            svg.append("circle")
                .attr("cx",1070)
                .attr("cy",90)
                .attr("r", 6)
                .style("fill", "blue")
                .on("click", function(){
                    // is the element currently visible ?
                    currentOpacity = d3.selectAll(".blue").style("opacity")
                    // Change the opacity: from 0 to 1 or from 1 to 0
                    d3.selectAll(".blue").transition().style("opacity", currentOpacity == 1 ? 0:1)});
            svg.append("circle")
                .attr("cx",1070)
                .attr("cy",120)
                .attr("r", 6)
                .style("fill", "black")
                .on("click", function(){
                    // is the element currently visible ?
                    currentOpacity = d3.selectAll(".black").style("opacity")
                    // Change the opacity: from 0 to 1 or from 1 to 0
                    d3.selectAll(".black").transition().style("opacity", currentOpacity == 1 ? 0:1)});

            svg.append("text").attr("x", 1090).attr("y", 60).text("vulnerable").style("font-size", "15px")
                .attr("alignment-baseline","middle");
            svg.append("text")
                .data(data)
                .attr("x", 1090).attr("y", 75)
                .text(function(){
                    return countLabel(data, 'red', vulnValue);
                })
                .style("font-size", "15px").attr("alignment-baseline","middle");

            svg.append("text").attr("x", 1090).attr("y", 90).text("predicted OUT").style("font-size", "15px")
                .attr("alignment-baseline","middle");
            svg.append("text")
                .data(data)
                .attr("x", 1090).attr("y", 105)
                .text(function(){
                    return countLabel(data, 'blue', vulnValue);
                })
                .style("font-size", "15px").attr("alignment-baseline","middle");

            svg.append("text").attr("x", 1090).attr("y", 120).text("not vulnerable").style("font-size", "15px")
                .attr("alignment-baseline","middle");
            svg.append("text")
                .data(data)
                .attr("x", 1090).attr("y", 135)
                .text(function(){
                    return countLabel(data, 'black', vulnValue);
                })
                .style("font-size", "15px").attr("alignment-baseline","middle");

            svg.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return xScale(d.example_class);
                })
                .attr("cy", function (d) {
                    return yScale(d.vulnerability_difference);
                    // return yScale(Math.abs(d.vulnerability_difference));
                })
                .attr("r", 2)
                .attr("fill", function (d) {
                    // var abs = Math.abs(d.vulnerability_difference);
                    var abs = Number(d.vulnerability_difference);
                    var target_pred = d.predictions.target_prediction;
                    var i = target_pred > 0 ? 1 : 0;
                    if (i==1){
                        if (abs <= Number(vulnValue)){
                            i = 2;
                        }
                    }
                    return ['blue', 'red', 'black'][i];
                })
                .attr("class", function (d) {
                    // var abs = Math.abs(d.vulnerability_difference);
                    var abs = Number(d.vulnerability_difference);
                    var target_pred = d.predictions.target_prediction;
                    var i = target_pred > 0 ? 1 : 0;
                    if (i==1){
                        if (abs <= Number(vulnValue)){
                            i = 2;
                        }
                    }
                    return ['blue', 'red', 'black'][i];
                })
                .on('mouseover', function (d, i) {
                    d3.select(this).transition()
                        .duration('100')
                        .attr("r", 4);
                    div.transition()
                        .duration(100)
                        .style("opacity", 1);
                    div.html(function() {
                        var info = "Index: " + (d.example_index) + " | Class: " + (d.example_class)
                            + "<br/>" + "  Target Conf: " + (d.confidences.target_confidence)
                            + " | Shadow Conf: " + (d.confidences.shadow_confidence)
                            + "<br/>" + "  Shadow Conf+: " + (d.confidences.shadow_confidences)
                            + "<br/>" + "  Vulnerability: " + (d.vulnerability_difference)
                            + "<br/>" + "  Predictions:  Target: " + (d.predictions.target_prediction);
                        if (imageDir !== "N/A"){
                            info = info + "<br/>" + "<img src='" + imageDir + "/" + d.example_class + "-" +
                                d.example_index + ".png' alt='Smiley face' height='42' width='42'>"
                        }
                        return info
                    })

                })
                .on('mouseout', function (d, i) {
                    d3.select(this).transition()
                        .duration('200')
                        .attr("r", 2);

                });

        })
    }

    function calculateColor(result, vulnValue){
        // var abs = Math.abs(result.vulnerability_difference);
        var abs = Number(result.vulnerability_difference);
        var target_pred = result.predictions.target_prediction;
        var i = target_pred > 0 ? 1 : 0;
        if (i==1){
            if (abs <= vulnValue){
                i = 2;
            }
        }
        return ['blue', 'red', 'black'][i];
    }

    function countLabel(data, returnColor, vulnValue){
        var redCount = 0;
        var blueCount = 0;
        var blackCount = 0;
        for (i =0; i < data.length; i++){
            var color = calculateColor(data[i], vulnValue);
            if (color === 'red'){
                redCount++;
            }
            else if(color === 'blue'){
                blueCount++;
            }
            else{
                blackCount++;
            }
        }
        if (returnColor === 'red'){
            return redCount;
        }
        else if(returnColor === 'blue'){
            return blueCount;
        }
        else{
            return blackCount;
        }
    }

    function displayCompare(divName, jsonFile, jsonFile2, model_num_1, model_num_2){
        console.log(jsonFile);
        console.log(jsonFile2);
        d3.select(divName).html("");
        d3.select("#target").html("");
        d3.select("#tooltip").html("");
        d3.select("#tooltip2").html("");
        var imageDir = "N/A";
        var svg = d3.select(divName)
            .append("svg")
            .attr("width", width + margin.left + margin.right + 60)
            .attr("height", height + margin.top + margin.bottom + 20)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
        d3.json(jsonFile, function (json) {
            data = json.vulnerability_results;
            d3.json(jsonFile2, function (json2) {
                data2 = json2.vulnerability_results;
                svg.append("text")
                    .attr("x", 400)
                    .attr("y", 10)
                    .style("text-anchor", "end")
                    .text("Experiment " + model_num_2 + " " +json2.target_accuracy);
                svg.append("text")
                    .attr("x", 700)
                    .attr("y", 10)
                    .style("text-anchor", "end")
                    .text("Experiment " + model_num_1 + " " +json.target_accuracy);
                var xMin = d3.min(data, function (d) {
                    return Number(d.vulnerability_difference);
                });
                var xMax = d3.max(data, function (d) {
                    return Number(d.vulnerability_difference);
                });

                var yMin = d3.min(data2, function (d) {
                    return Number(d.vulnerability_difference);
                });
                var yMax = d3.max(data2, function (d) {
                    return Number(d.vulnerability_difference);
                });

                var xScale = d3.scaleLinear().domain([xMin, xMax]).range([margin.right, width - margin.right * 2]);
                var yScale = d3.scaleLinear().domain([yMin, yMax]).range([height - margin.bottom, margin.top * 2]);

                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(xScale));
                svg.append("text")
                    .attr("class", "label")
                    .attr("x", width - 360)
                    .attr("y", height + margin.top + margin.bottom)
                    .style("text-anchor", "end")
                    .text("Vulnerability Experiment " + model_num_1);

                svg.append("g")
                    .call(d3.axisLeft(yScale));
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y",-margin.top*3.3) //bigger mulitplier moves to the left
                    .attr("x",-height/2)  //smaller divider moves up
                    .attr("dy", ".71em")
                    .style("text-anchor", "middle")
                    .text("Vulnerability Experiment " + model_num_2)
                    .attr("font-family","serif")
                    .attr("font-size","16px");

                svg.append('g')
                    .selectAll("dot")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) {
                        return xScale(d.vulnerability_difference);
                    })
                    .on('mouseover', function (d) {
                        displaySecondData(d, model_num_1, jsonFile);
                        d3.select(this).transition()
                            .duration('100')
                            .attr("r", 4);
                        div.transition()
                            .duration(100)
                            .style("opacity", 1);
                        div.html(function() {
                            var info = "Model " + model_num_2 + " | Model Id: "+ (d.model_id) +" | Index: " + (d.example_index)
                                + " | Class: " + (d.example_class)
                                + "<br/>" + "  Target Conf: " + (d.confidences.target_confidence)
                                + " | Shadow Conf: " + (d.confidences.shadow_confidence)
                                + "<br/>" + "  Shadow Conf+: " + (d.confidences.shadow_confidences)
                                + "<br/>" + "  Vulnerability: " + (d.vulnerability_difference)
                                + "<br/>" + "  Predictions:  Target: " + (d.predictions.target_prediction);
                            if (imageDir !== "N/A"){
                                info = info + "<br/>" + "<img src='" + imageDir + "/" + d.example_class + "-" +
                                    d.example_index + ".png' alt='Smiley face' height='42' width='42'>"
                            }
                            return info
                        })

                    })
                    .on('mouseout', function (d, i) {
                        d3.select(this).transition()
                            .duration('200')
                            .attr("r", 2);

                    })
                    .data(data2)
                    .attr("cy", function (d) {
                        return yScale(d.vulnerability_difference);
                    })
                    .attr("r", 2)
                    .attr("fill", "blue");
            })

        })
    }

    function displayAbs(divName, jsonFile, jsonFile2, model_num_1, model_num_2){
        console.log(jsonFile);
        console.log(jsonFile2);
        d3.select(divName).html("");
        d3.select("#target").html("");
        d3.select("#tooltip").html("");
        d3.select("#tooltip2").html("");
        var imageDir = "N/A";
        var svg = d3.select(divName)
            .append("svg")
            .attr("width", width + margin.left + margin.right + 60)
            .attr("height", height + margin.top + margin.bottom + 20)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
        d3.json(jsonFile, function (json) {
            data = json.vulnerability_results;
            d3.json(jsonFile2, function (json2) {
                data2 = json2.vulnerability_results;
                svg.append("text")
                    .attr("x", 400)
                    .attr("y", 10)
                    .style("text-anchor", "end")
                    .text("Experiment " + model_num_2 + " " +json2.target_accuracy);
                svg.append("text")
                    .attr("x", 700)
                    .attr("y", 10)
                    .style("text-anchor", "end")
                    .text("Experiment " + model_num_1 + " " +json.target_accuracy);
                var xMin = d3.min(data, function (d) {
                    return Number(d.abs_vulnerability_difference);
                });
                var xMax = d3.max(data, function (d) {
                    return Number(d.abs_vulnerability_difference);
                });

                var yMin = d3.min(data2, function (d) {
                    return Number(d.abs_vulnerability_difference);
                });
                var yMax = d3.max(data2, function (d) {
                    return Number(d.abs_vulnerability_difference);
                });

                var xScale = d3.scaleLinear().domain([xMin, xMax]).range([margin.right, width - margin.right * 2]);
                var yScale = d3.scaleLinear().domain([yMin, yMax]).range([height - margin.bottom, margin.top * 2]);

                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(xScale));
                svg.append("text")
                    .attr("class", "label")
                    .attr("x", width - 360)
                    .attr("y", height + margin.top + margin.bottom)
                    .style("text-anchor", "end")
                    .text("Vulnerability Experiment " + model_num_1);

                svg.append("g")
                    .call(d3.axisLeft(yScale));
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y",-margin.top*3.3) //bigger mulitplier moves to the left
                    .attr("x",-height/2)  //smaller divider moves up
                    .attr("dy", ".71em")
                    .style("text-anchor", "middle")
                    .text("Vulnerability Experiment " + model_num_2)
                    .attr("font-family","serif")
                    .attr("font-size","16px");

                svg.append('g')
                    .selectAll("dot")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) {
                        return xScale(d.abs_vulnerability_difference);
                    })
                    .on('mouseover', function (d) {
                        displayAbsSecondData(d, model_num_1, jsonFile);
                        d3.select(this).transition()
                            .duration('100')
                            .attr("r", 4);
                        div.transition()
                            .duration(100)
                            .style("opacity", 1);
                        div.html(function() {
                            var info = "Model " + model_num_2 + " | Model Id: "+ (d.model_id) +" | Index: " + (d.example_index)
                                + " | Class: " + (d.example_class)
                                + "<br/>" + "  Target Conf: " + (d.confidences.target_confidence)
                                + " | Shadow Conf: " + (d.confidences.shadow_confidence)
                                + "<br/>" + "  Shadow Conf+: " + (d.confidences.shadow_confidences)
                                + "<br/>" + "  Vulnerability: " + (d.vulnerability_difference)
                                + "<br/>" + "  Abs Vulnerability: " + (d.abs_vulnerability_difference)
                                + "<br/>" + "  Predictions:  Target: " + (d.predictions.target_prediction);
                            if (imageDir !== "N/A"){
                                info = info + "<br/>" + "<img src='" + imageDir + "/" + d.example_class + "-" +
                                    d.example_index + ".png' alt='Smiley face' height='42' width='42'>"
                            }
                            return info
                        })

                    })
                    .on('mouseout', function (d, i) {
                        d3.select(this).transition()
                            .duration('200')
                            .attr("r", 2);

                    })
                    .data(data2)
                    .attr("cy", function (d) {
                        return yScale(d.abs_vulnerability_difference);
                    })
                    .attr("r", 2)
                    .attr("fill", "blue");
            })

        })
    }

    function displaySecondData(data, model_num, json_file){
        console.log(data);
        d3.json(json_file, function (json2) {
            data2 = json2.vulnerability_results;
            for (var i = 0; i < data2.length; i++){
                if(data2[i].example_index === data.example_index && data2[i].model_id === data.model_id){
                    console.log(data2[i]);
                    div2.transition()
                        .duration(100)
                        .style("opacity", 1);
                    div2.html(function() {
                        var info = "Model " +model_num + " | Model Id: "+ (data2[i].model_id) +" | Index: "
                            + (data2[i].example_index) + " | Class: " + (data2[i].example_class)
                            + "<br/>" + "  Target Conf: " + (data2[i].confidences.target_confidence)
                            + " | Shadow Conf: " + (data2[i].confidences.shadow_confidence)
                            + "<br/>" + "  Shadow Conf+: " + (data2[i].confidences.shadow_confidences)
                            + "<br/>" + "  Vulnerability: " + (data2[i].vulnerability_difference)
                            + "<br/>" + "  Predictions:  Target: " + (data2[i].predictions.target_prediction);
                        return info
                    });
                }
            }
        });
    }

    function displayAbsSecondData(data, model_num, json_file){
        console.log(data);
        d3.json(json_file, function (json2) {
            data2 = json2.vulnerability_results;
            for (var i = 0; i < data2.length; i++){
                if(data2[i].example_index === data.example_index && data2[i].model_id === data.model_id){
                    console.log(data2[i]);
                    div2.transition()
                        .duration(100)
                        .style("opacity", 1);
                    div2.html(function() {
                        var info = "Model " +model_num + " | Model Id: "+ (data2[i].model_id) +" | Index: "
                            + (data2[i].example_index) + " | Class: " + (data2[i].example_class)
                            + "<br/>" + "  Target Conf: " + (data2[i].confidences.target_confidence)
                            + " | Shadow Conf: " + (data2[i].confidences.shadow_confidence)
                            + "<br/>" + "  Shadow Conf+: " + (data2[i].confidences.shadow_confidences)
                            + "<br/>" + "  Vulnerability: " + (data2[i].vulnerability_difference)
                            + "<br/>" + "  Abs Vulnerability: " + (data2[i].abs_vulnerability_difference)
                            + "<br/>" + "  Predictions:  Target: " + (data2[i].predictions.target_prediction);
                        return info
                    });
                }
            }
        });
    }

    //initalize graph
    displayGraph("#my_dataviz", "results_emnist9_All.json","emnist", 1.0);

</script>